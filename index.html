<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Brick Breaker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@300;400;600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap');

        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            background: #0a0a0f;
            color: #fff;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            transition: background 2s ease
        }

        body.warm-bg {
            background: linear-gradient(135deg, #2d1b3d, #4a1942, #6b2150, #8b2252)
        }

        #game-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center
        }

        canvas {
            display: block;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 4px;
            background: #0d0d14;
            box-shadow: 0 0 60px rgba(100, 100, 255, 0.04)
        }

        #name-screen {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.95);
            z-index: 5;
            gap: 24px
        }

        #name-screen h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 1.4rem;
            color: #fff;
            text-shadow: 0 0 20px rgba(150, 150, 255, 0.3);
            text-align: center;
            line-height: 2;
            padding: 0 20px
        }

        #name-screen p.subtitle {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.35);
            letter-spacing: 2px;
            text-transform: uppercase
        }

        #name-input {
            font-family: 'Press Start 2P', monospace;
            font-size: 1.1rem;
            padding: 14px 24px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border-radius: 6px;
            text-align: center;
            outline: none;
            width: 320px;
            max-width: 85vw;
            letter-spacing: 4px;
            text-transform: uppercase;
            transition: border-color 0.3s ease
        }

        #name-input:focus {
            border-color: rgba(255, 255, 255, 0.5)
        }

        #name-input::placeholder {
            color: rgba(255, 255, 255, 0.15);
            letter-spacing: 2px;
            font-size: 0.7rem
        }

        #name-error {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.55rem;
            color: #ff6b6b;
            height: 20px;
            text-align: center
        }

        .btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.75rem;
            padding: 14px 32px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: #fff;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.25s ease;
            letter-spacing: 1px
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1)
        }

        #overlay {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0);
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s ease, background 1s ease;
            z-index: 10
        }

        #overlay.active {
            pointer-events: all;
            opacity: 1;
            background: rgba(0, 0, 0, 1)
        }

        #overlay.transparent-bg {
            background: rgba(0, 0, 0, 0)
        }

        #gameover-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            z-index: 5
        }

        #gameover-screen.active {
            display: flex
        }

        #gameover-screen h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 2.2rem;
            color: #ff4444;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            animation: glitchPulse 1.5s infinite
        }

        @keyframes glitchPulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0.85
            }
        }

        /* Win screen for non-VIP */
        #win-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            z-index: 5;
            gap: 20px
        }

        #win-screen.active {
            display: flex
        }

        #win-screen h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 2rem;
            color: #44ff88;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(68, 255, 136, 0.5)
        }

        #win-screen p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 1px
        }

        /* Reveal text - elegant romantic */
        .reveal-text {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            font-style: italic;
            font-size: 2rem;
            color: #fff;
            opacity: 0;
            transition: opacity 2s ease;
            text-align: center;
            padding: 0 40px;
            line-height: 1.8;
            letter-spacing: 1.5px
        }

        .reveal-text.visible {
            opacity: 1
        }

        .click-hint {
            position: fixed;
            bottom: 40px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.2);
            letter-spacing: 3px;
            text-transform: uppercase;
            font-family: 'Cormorant Garamond', serif;
            opacity: 0;
            transition: opacity 1s ease
        }

        .click-hint.visible {
            opacity: 1
        }

        #proposal-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            gap: 35px
        }

        #proposal-screen.active {
            display: flex
        }

        #proposal-screen h1 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            font-style: italic;
            font-size: 2.4rem;
            color: #fff;
            text-align: center;
            padding: 0 20px;
            letter-spacing: 2px;
            opacity: 0;
            animation: fadeUp 1.5s ease forwards
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .proposal-buttons {
            display: flex;
            gap: 24px;
            animation: fadeUp 1.2s ease 0.6s forwards;
            opacity: 0
        }

        .btn-yes,
        .btn-no-styled {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 16px 48px;
            border: none;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.4s ease;
            letter-spacing: 1px
        }

        .btn-yes {
            background: linear-gradient(135deg, #e84393, #fd79a8);
            color: #fff;
            box-shadow: 0 4px 25px rgba(232, 67, 147, 0.4)
        }

        .btn-yes:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 35px rgba(232, 67, 147, 0.6)
        }

        .btn-no-styled {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: rgba(255, 255, 255, 0.5)
        }

        .btn-no-styled:hover {
            border-color: rgba(255, 255, 255, 0.4)
        }

        #celebration {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30
        }

        #celebration.active {
            display: flex
        }

        #celebration h1 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            font-style: italic;
            font-size: 2.8rem;
            color: #fff;
            opacity: 0;
            animation: fadeUp 1.5s ease 0.5s forwards;
            text-shadow: 0 0 40px rgba(232, 67, 147, 0.5)
        }

        #confetti-canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 25
        }

        #powerup-hud {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            z-index: 4;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.45rem
        }

        .pu-indicator {
            padding: 6px 10px;
            border-radius: 4px;
            color: #fff;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .pu-indicator.active {
            opacity: 1
        }

        .pu-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block
        }

        #music-btn {
            position: fixed;
            bottom: 12px;
            right: 12px;
            z-index: 40;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.1rem;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease
        }

        #music-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff
        }

        @media(max-width:600px) {
            canvas {
                width: 95vw !important;
                height: auto !important
            }

            #gameover-screen h1 {
                font-size: 1.4rem
            }

            .reveal-text {
                font-size: 1.4rem
            }

            #proposal-screen h1 {
                font-size: 1.6rem
            }

            #celebration h1 {
                font-size: 1.8rem
            }

            #name-screen h1 {
                font-size: 0.9rem
            }

            #name-input {
                font-size: 0.8rem;
                width: 260px
            }
        }
    </style>
</head>

<body>
    <div id="game-wrapper"><canvas id="gameCanvas"></canvas></div>
    <div id="name-screen">
        <h1>BRICK BREAKER</h1>
        <p class="subtitle">Enter a name to play</p><input type="text" id="name-input" maxlength="8"
            placeholder="Your name" autofocus autocomplete="off" spellcheck="false">
        <p id="name-error">&nbsp;</p><button class="btn" id="btn-start">START GAME</button>
    </div>
    <div id="gameover-screen">
        <h1>GAME OVER</h1><button class="btn" id="btn-retry">PLAY AGAIN</button>
    </div>
    <div id="win-screen">
        <h1>YOU WIN!</h1>
        <p>Nice one. Play again?</p><button class="btn" id="btn-win-retry">PLAY AGAIN</button>
    </div>
    <div id="overlay">
        <p class="reveal-text" id="reveal-msg"></p>
        <p class="click-hint" id="click-hint">click to continue</p>
    </div>
    <div id="proposal-screen">
        <h1 id="proposal-text"></h1>
        <div class="proposal-buttons" id="proposal-btns"><button class="btn-yes" id="btn-yes">Yes</button><button
                class="btn-no-styled" id="btn-no">No</button></div>
        <p id="no-hint"
            style="font-family:'Cormorant Garamond',serif;font-style:italic;font-size:0.95rem;color:rgba(255,255,255,0.45);margin-top:10px;opacity:0;transition:opacity 1s ease">
        </p>
    </div>
    <div id="celebration">
        <h1 id="celeb-text">I love you ‚ù§Ô∏è</h1>
    </div>
    <canvas id="confetti-canvas"></canvas>
    <div id="powerup-hud">
        <div class="pu-indicator" id="pu-fire"><span class="pu-dot" style="background:#ff4444"></span>FIREBALL <span
                id="pu-fire-t"></span></div>
        <div class="pu-indicator" id="pu-wide"><span class="pu-dot" style="background:#44ff88"></span>WIDE PADDLE <span
                id="pu-wide-t"></span></div>
        <div class="pu-indicator" id="pu-slow"><span class="pu-dot" style="background:#ffdd44"></span>SLOW BALL <span
                id="pu-slow-t"></span></div>
        <div class="pu-indicator" id="pu-multi"><span class="pu-dot" style="background:#4488ff"></span>MULTI-BALL</div>
    </div>
    <button id="music-btn" title="Toggle music">üîá</button>
    <script>
        // ‚ïê‚ïê VIP NAMES (secret) ‚ïê‚ïê
        const VIP = new Set(['mamun', 'anchal', 'aanchal', 'yogi', 'nisha', 'nysha', 'A', 'nitya', 'kunmun', 'baby', 'cutie', 'sexy', 'ruby', 'swati', 'leena', 'nirmala', 'noor', 'vani', 'mishti', 'geli', 'rana', 'nancy', 'anu', 'varsham', 'nivesh', 'ayush', 'kuril', 'aryan', 'arote', 'gautam', 'goutam', 'musheer', 'mushy', 'laad', 'mukund', 'rahul', 'krish', 'naitik', 'ansh', 'aneesh', 'hiya', 'iccha', 'aditya', 'jinu', 'akarshan', 'yaj', 'pranav', 'tanush', 'tanish', 'jagtar', 'sakshi', 'tanmay', 'anuj', 'yugam', 'vinayak', 'yogesh', 'soni', 'ramesh', 'ayushi']);

        // ‚ïê‚ïê COMPACT PIXEL FONT ‚ïê‚ïê
        const FD = { A: [0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11], B: [0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E], C: [0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E], D: [0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E], E: [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F], F: [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10], G: [0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0E], H: [0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11], I: [0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1F], J: [0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C], K: [0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11], L: [0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F], M: [0x11, 0x1B, 0x15, 0x15, 0x11, 0x11, 0x11], N: [0x11, 0x19, 0x15, 0x15, 0x15, 0x13, 0x11], O: [0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E], P: [0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10], Q: [0x0E, 0x11, 0x11, 0x11, 0x15, 0x12, 0x0D], R: [0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11], S: [0x0E, 0x11, 0x10, 0x0E, 0x01, 0x11, 0x0E], T: [0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04], U: [0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E], V: [0x11, 0x11, 0x11, 0x11, 0x0A, 0x0A, 0x04], W: [0x11, 0x11, 0x11, 0x15, 0x15, 0x1B, 0x11], X: [0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11], Y: [0x11, 0x11, 0x0A, 0x04, 0x04, 0x04, 0x04], Z: [0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F] };
        FD[' '] = [0, 0, 0, 0, 0, 0, 0];
        for (let i = 0; i <= 9; i++) { const S = [[0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E], [0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E], [0x0E, 0x11, 0x01, 0x02, 0x04, 0x08, 0x1F], [0x0E, 0x11, 0x01, 0x06, 0x01, 0x11, 0x0E], [0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02], [0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E], [0x0E, 0x10, 0x10, 0x1E, 0x11, 0x11, 0x0E], [0x1F, 0x01, 0x02, 0x04, 0x04, 0x04, 0x04], [0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E], [0x0E, 0x11, 0x11, 0x0F, 0x01, 0x01, 0x0E]]; FD[String(i)] = S[i] }
        function decG(hex, ch) { if (ch === ' ') return [[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]; return hex.map(v => { const r = []; for (let b = 4; b >= 0; b--)r.push((v >> b) & 1); return r }) }

        // ‚ïê‚ïê CONFIG ‚ïê‚ïê
        const CW = 800, CH = 600, BR = 6, PH = 12, PW0 = 110, SPD0 = 3.2, SINC = 1.04, BTO = 50;
        const BPAL = ['#5e6577', '#6a7080', '#717888', '#7d8493', '#8890a0', '#949caa', '#a0a8b4', '#abb3bf', '#b5bcc8', '#c0c7d1'];
        const PUT = ['fireball', 'widePaddle', 'multiBall', 'slowBall'];
        const PUC = { fireball: '#ff4444', widePaddle: '#44ff88', multiBall: '#4488ff', slowBall: '#ffdd44' };

        // ‚ïê‚ïê ELEMENTS ‚ïê‚ïê
        const cv = document.getElementById('gameCanvas'), ctx = cv.getContext('2d'); cv.width = CW; cv.height = CH;
        const $ = id => document.getElementById(id);
        const nameScr = $('name-screen'), nameIn = $('name-input'), nameErr = $('name-error'), btnSt = $('btn-start');
        const goScr = $('gameover-screen'), winScr = $('win-screen'), ov = $('overlay'), rMsg = $('reveal-msg'), cHint = $('click-hint');
        const propScr = $('proposal-screen'), propTxt = $('proposal-text'), propBtns = $('proposal-btns');
        const celeb = $('celebration'), celebTxt = $('celeb-text');
        const bRetry = $('btn-retry'), bWinRetry = $('btn-win-retry'), bYes = $('btn-yes'), bNo = $('btn-no');
        const ccv = $('confetti-canvas'), cc = ccv.getContext('2d');
        const musicBtn = $('music-btn');

        // ‚ïê‚ïê STATE ‚ïê‚ïê
        let gs = 'name', pName = '', pNameDisplay = '', isVIP = false, score = 0, totB = 0, winTarget = 0, hitsS = 0, animId = null;
        let oneMoreShown = false, oneMoreAlpha = 0, wonFlashTimer = 0;
        let balls = [], bricks = [], particles = [];
        let px, py, curPW = PW0, mouseX = CW / 2;
        let pu = { fireball: 0, widePaddle: 0, slowBall: 0, multiBall: false };
        let lastTime = 0, swapped = false;

        // ‚ïê‚ïê AUDIO ‚ïê‚ïê
        let actx = null, musicPlaying = false, musicGain = null, romanticPlaying = false;
        const NT = { C3: 130.81, E3: 164.81, F3: 174.61, G3: 196, A3: 220, B3: 246.94, C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23, G4: 392, A4: 440, B4: 493.88, C5: 523.25, D5: 587.33, E5: 659.25 };
        const melody = [['E4', 0.15], ['E4', 0.15], [null, 0.15], ['E4', 0.15], [null, 0.15], ['C4', 0.15], ['E4', 0.3], ['G4', 0.3], [null, 0.3], ['G3', 0.3], [null, 0.3], ['C4', 0.2], [null, 0.1], ['G3', 0.2], [null, 0.1], ['E3', 0.2], [null, 0.1], ['A3', 0.2], ['B3', 0.2], ['A3', 0.1], ['A3', 0.2], ['G3', 0.2], ['E4', 0.2], ['G4', 0.2], ['A4', 0.3], ['F4', 0.15], ['G4', 0.15], [null, 0.15], ['E4', 0.2], ['C4', 0.15], ['D4', 0.15], ['B3', 0.2]];
        // Romantic melody - gentle, slow
        const romanticMelody = [['E4', 0.5], ['G4', 0.5], ['A4', 0.75], [null, 0.25], ['G4', 0.5], ['E4', 0.5], ['D4', 0.75], [null, 0.25], ['C4', 0.5], ['E4', 0.5], ['G4', 0.75], [null, 0.25], ['A4', 0.5], ['G4', 0.5], ['E4', 0.75], [null, 0.5], ['F4', 0.5], ['A4', 0.5], ['G4', 0.75], [null, 0.25], ['E4', 0.5], ['D4', 0.5], ['C4', 1], [null, 0.5], ['E4', 0.5], ['G4', 0.5], ['C5', 0.75], [null, 0.25], ['B4', 0.5], ['A4', 0.5], ['G4', 1], [null, 0.5]];

        function initAudio() { if (actx) return; actx = new (window.AudioContext || window.webkitAudioContext)(); musicGain = actx.createGain(); musicGain.gain.value = 0.08; musicGain.connect(actx.destination) }

        function playMelodyLoop(notes, type) {
            if (!actx) return;
            if (type === 'arcade') musicPlaying = true;
            if (type === 'romantic') romanticPlaying = true;
            musicBtn.textContent = 'üîä';
            let t = actx.currentTime + 0.1;
            const waveType = type === 'romantic' ? 'sine' : 'square';
            const vol = type === 'romantic' ? 0.25 : 0.3;
            function sched() {
                if (type === 'arcade' && !musicPlaying) return;
                if (type === 'romantic' && !romanticPlaying) return;
                for (const [note, dur] of notes) {
                    if (note) {
                        const o = actx.createOscillator(), g = actx.createGain();
                        o.type = waveType; o.frequency.value = NT[note];
                        g.gain.setValueAtTime(vol, t); g.gain.exponentialRampToValueAtTime(0.01, t + dur * 0.9);
                        o.connect(g); g.connect(musicGain); o.start(t); o.stop(t + dur);
                    }
                    t += dur;
                }
                const check = type === 'arcade' ? musicPlaying : romanticPlaying;
                if (check) setTimeout(sched, (t - actx.currentTime - 0.2) * 1000);
            }
            sched();
        }
        function stopMusic() { musicPlaying = false; romanticPlaying = false; musicBtn.textContent = 'üîá' }
        function stopArcade() { musicPlaying = false }

        musicBtn.addEventListener('click', () => { initAudio(); if (musicPlaying || romanticPlaying) stopMusic(); else { if (gs === 'playing') playMelodyLoop(melody, 'arcade'); else if (gs === 'reveal' || gs === 'proposal') playMelodyLoop(romanticMelody, 'romantic') } });

        function playSfx(f, d) { if (!actx) return; const o = actx.createOscillator(), g = actx.createGain(); o.type = 'square'; o.frequency.value = f; g.gain.setValueAtTime(0.1, actx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + d); o.connect(g); g.connect(actx.destination); o.start(); o.stop(actx.currentTime + d) }
        function sfxHit() { playSfx(520, 0.08) }
        function sfxPU() { playSfx(880, 0.15); setTimeout(() => playSfx(1100, 0.12), 80) }
        function sfxLose() { playSfx(200, 0.3); setTimeout(() => playSfx(150, 0.4), 150) }
        function sfxWin() { playSfx(523, 0.12); setTimeout(() => playSfx(659, 0.12), 100); setTimeout(() => playSfx(784, 0.12), 200); setTimeout(() => playSfx(1047, 0.25), 300) }

        // ‚ïê‚ïê BRICK GENERATION ‚ïê‚ïê
        function genBricks(name) {
            const chars = name.toUpperCase().split(''); bricks = [];
            let totalCols = 0; const glyphs = [];
            for (const ch of chars) { const hex = FD[ch]; if (!hex) continue; const g = decG(hex, ch); glyphs.push(g); totalCols += g[0].length + 1 }
            totalCols -= 1;
            const rows = 7, margin = 30, availW = CW - margin * 2;
            let bW = Math.floor(availW / totalCols), bH = Math.floor((CH * 0.35) / rows);
            bW = Math.min(bW, 18); bH = Math.min(bH, 18); if (bW < 6) bW = 6; if (bH < 6) bH = 6;
            const gap = 2, eW = bW + gap, eH = bH + gap;
            const gW = totalCols * eW, oX = (CW - gW) / 2, oY = BTO;
            let col = 0, ci = 0;
            for (const g of glyphs) {
                const cC = g[0].length;
                for (let r = 0; r < rows; r++)for (let cc2 = 0; cc2 < cC; cc2++) {
                    if (g[r][cc2] === 1) bricks.push({ x: oX + (col + cc2) * eW, y: oY + r * eH, w: bW, h: bH, alive: true, color: BPAL[ci % BPAL.length], powerUp: null, flashT: 0 });
                } col += cC + 1; ci++
            }
            const puC = Math.max(4, Math.floor(bricks.length * 0.18));
            const idx = [...Array(bricks.length).keys()];
            for (let i = idx.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[idx[i], idx[j]] = [idx[j], idx[i]] }
            for (let i = 0; i < puC && i < idx.length; i++)bricks[idx[i]].powerUp = PUT[i % PUT.length];
            totB = bricks.length;
            winTarget = Math.ceil(totB * 0.95);
        }

        // ‚ïê‚ïê INIT ‚ïê‚ïê
        function initGame() {
            score = 0; hitsS = 0; pu = { fireball: 0, widePaddle: 0, slowBall: 0, multiBall: false }; curPW = PW0; particles = []; swapped = false; oneMoreShown = false; oneMoreAlpha = 0; wonFlashTimer = 0;
            genBricks(pName);
            balls = [{ x: CW / 2, y: CH - 90, dx: 0, dy: 0, _trail: [] }];
            const a = -Math.PI / 4 + (Math.random() * Math.PI / 6 - Math.PI / 12);
            balls[0].dx = Math.cos(a) * SPD0; balls[0].dy = -Math.abs(Math.sin(a) * SPD0);
            px = CW / 2 - curPW / 2; py = CH - 36; lastTime = performance.now(); updateHUD();
        }

        function spawnP(x, y, color, n) { for (let i = 0; i < n; i++) { const a = Math.random() * Math.PI * 2, s = 1 + Math.random() * 3; particles.push({ x, y, dx: Math.cos(a) * s, dy: Math.sin(a) * s, life: 1, color, sz: 2 + Math.random() * 3 }) } }

        function activatePU(type) {
            sfxPU();
            if (type === 'fireball') pu.fireball = 10;
            else if (type === 'widePaddle') { pu.widePaddle = 20; curPW = PW0 * 1.5 }
            else if (type === 'slowBall') pu.slowBall = 30;
            else if (type === 'multiBall') {
                pu.multiBall = true;
                if (balls.length === 1) {
                    const b = balls[0], sp = Math.sqrt(b.dx * b.dx + b.dy * b.dy);
                    balls.push({ x: b.x, y: b.y, dx: sp * Math.cos(-Math.PI / 3), dy: -sp * Math.sin(Math.PI / 3), _trail: [] });
                    balls.push({ x: b.x, y: b.y, dx: sp * Math.cos(-2 * Math.PI / 3), dy: -sp * Math.sin(2 * Math.PI / 3), _trail: [] })
                }
            }
            updateHUD();
        }

        function updateHUD() {
            $('pu-fire').classList.toggle('active', pu.fireball > 0); $('pu-wide').classList.toggle('active', pu.widePaddle > 0);
            $('pu-slow').classList.toggle('active', pu.slowBall > 0); $('pu-multi').classList.toggle('active', pu.multiBall);
            if (pu.fireball > 0) $('pu-fire-t').textContent = Math.ceil(pu.fireball) + 's';
            if (pu.widePaddle > 0) $('pu-wide-t').textContent = Math.ceil(pu.widePaddle) + 's';
            if (pu.slowBall > 0) $('pu-slow-t').textContent = Math.ceil(pu.slowBall) + 's';
        }

        // ‚ïê‚ïê DRAW ‚ïê‚ïê
        function drawBall(b) {
            const f = pu.fireball > 0; ctx.beginPath(); ctx.arc(b.x, b.y, BR, 0, Math.PI * 2); ctx.fillStyle = f ? '#ff6633' : '#fff'; ctx.fill();
            ctx.beginPath(); ctx.arc(b.x, b.y, BR + 4, 0, Math.PI * 2); const g = ctx.createRadialGradient(b.x, b.y, BR, b.x, b.y, BR + 8); g.addColorStop(0, f ? 'rgba(255,100,50,0.3)' : 'rgba(255,255,255,0.15)'); g.addColorStop(1, 'rgba(0,0,0,0)'); ctx.fillStyle = g; ctx.fill();
            if (f && b._trail) for (let i = 0; i < b._trail.length; i++) { const t = b._trail[i], al = (i / b._trail.length) * 0.3; ctx.beginPath(); ctx.arc(t.x, t.y, BR * (i / b._trail.length), 0, Math.PI * 2); ctx.fillStyle = `rgba(255,80,30,${al})`; ctx.fill() }
        }
        function drawPaddle() { const w = pu.widePaddle > 0, r = 6; ctx.beginPath(); ctx.moveTo(px + r, py); ctx.lineTo(px + curPW - r, py); ctx.arcTo(px + curPW, py, px + curPW, py + r, r); ctx.lineTo(px + curPW, py + PH - r); ctx.arcTo(px + curPW, py + PH, px + curPW - r, py + PH, r); ctx.lineTo(px + r, py + PH); ctx.arcTo(px, py + PH, px, py + PH - r, r); ctx.lineTo(px, py + r); ctx.arcTo(px, py, px + r, py, r); ctx.closePath(); ctx.fillStyle = w ? '#88ffbb' : '#fff'; ctx.fill() }
        function drawBricks() { for (const b of bricks) { if (!b.alive) continue; const r = 2; ctx.beginPath(); ctx.moveTo(b.x + r, b.y); ctx.lineTo(b.x + b.w - r, b.y); ctx.arcTo(b.x + b.w, b.y, b.x + b.w, b.y + r, r); ctx.lineTo(b.x + b.w, b.y + b.h - r); ctx.arcTo(b.x + b.w, b.y + b.h, b.x + b.w - r, b.y + b.h, r); ctx.lineTo(b.x + r, b.y + b.h); ctx.arcTo(b.x, b.y + b.h, b.x, b.y + b.h - r, r); ctx.lineTo(b.x, b.y + r); ctx.arcTo(b.x, b.y, b.x + r, b.y, r); ctx.closePath(); ctx.fillStyle = b.color; ctx.fill(); ctx.fillStyle = 'rgba(255,255,255,0.08)'; ctx.fillRect(b.x + 1, b.y + 1, b.w - 2, 3) } }
        function drawParticles() { for (let i = particles.length - 1; i >= 0; i--) { const p = particles[i]; p.x += p.dx; p.y += p.dy; p.life -= 0.03; p.dy += 0.05; if (p.life <= 0) { particles.splice(i, 1); continue } ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.fillRect(p.x - p.sz / 2, p.y - p.sz / 2, p.sz, p.sz) } ctx.globalAlpha = 1 }
        function drawScore() {
            ctx.font = '13px "Press Start 2P",monospace'; ctx.fillStyle = 'rgba(255,255,255,0.6)'; ctx.textAlign = 'left'; ctx.fillText(`Score: ${score} / ${winTarget}`, 14, 28);
            // "One more!" message
            if (score === winTarget - 1 && !oneMoreShown) { oneMoreShown = true; oneMoreAlpha = 2.5 }
            if (oneMoreAlpha > 0) { oneMoreAlpha -= 0.008; const a = Math.min(1, oneMoreAlpha); ctx.save(); ctx.font = '20px "Press Start 2P",monospace'; ctx.fillStyle = `rgba(68,255,136,${a})`; ctx.textAlign = 'center'; ctx.fillText('ONE MORE!', CW / 2, CH / 2 - 30); ctx.restore() }
        }

        // ‚ïê‚ïê UPDATE ‚ïê‚ïê
        function update(dt) {
            const rect = cv.getBoundingClientRect(), scX = CW / rect.width;
            px = (mouseX - rect.left) * scX - curPW / 2; px = Math.max(0, Math.min(CW - curPW, px));
            if (pu.fireball > 0) { pu.fireball -= dt; if (pu.fireball <= 0) pu.fireball = 0 }
            if (pu.widePaddle > 0) { pu.widePaddle -= dt; if (pu.widePaddle <= 0) { pu.widePaddle = 0; curPW = PW0 } }
            if (pu.slowBall > 0) { pu.slowBall -= dt; if (pu.slowBall <= 0) pu.slowBall = 0 }
            updateHUD();
            const sf = pu.slowBall > 0 ? 0.55 : 1;
            for (let bi = balls.length - 1; bi >= 0; bi--) {
                const b = balls[bi]; if (!b._trail) b._trail = [];
                if (pu.fireball > 0) { b._trail.push({ x: b.x, y: b.y }); if (b._trail.length > 8) b._trail.shift() } else b._trail = [];
                b.x += b.dx * sf; b.y += b.dy * sf;
                if (b.x - BR <= 0) { b.x = BR; b.dx = Math.abs(b.dx) } if (b.x + BR >= CW) { b.x = CW - BR; b.dx = -Math.abs(b.dx) } if (b.y - BR <= 0) { b.y = BR; b.dy = Math.abs(b.dy) }
                if (b.y + BR >= py && b.y + BR <= py + PH + 6 && b.x >= px && b.x <= px + curPW && b.dy > 0) { const hp = (b.x - (px + curPW / 2)) / (curPW / 2), ang = hp * (Math.PI / 3), sp = Math.sqrt(b.dx * b.dx + b.dy * b.dy); b.dx = Math.sin(ang) * sp; b.dy = -Math.cos(ang) * sp; b.y = py - BR }
                if (b.y - BR > CH) { balls.splice(bi, 1); if (balls.length === 0) { sfxLose(); gs = 'gameover'; cancelAnimationFrame(animId); goScr.classList.add('active'); pu.multiBall = false; updateHUD(); return } continue }
                for (const br of bricks) {
                    if (!br.alive) continue;
                    if (b.x + BR > br.x && b.x - BR < br.x + br.w && b.y + BR > br.y && b.y - BR < br.y + br.h) {
                        br.alive = false; score++; hitsS++; sfxHit();
                        spawnP(br.x + br.w / 2, br.y + br.h / 2, br.powerUp ? PUC[br.powerUp] : br.color, br.powerUp ? 12 : 6);
                        if (br.powerUp) activatePU(br.powerUp);
                        if (pu.fireball <= 0) { const oL = (b.x + BR) - br.x, oR = (br.x + br.w) - (b.x - BR), oT = (b.y + BR) - br.y, oB = (br.y + br.h) - (b.y - BR); if (Math.min(oL, oR) < Math.min(oT, oB)) b.dx = -b.dx; else b.dy = -b.dy }
                        if (hitsS >= 5) { hitsS = 0; for (const bl of balls) { const sp = Math.sqrt(bl.dx * bl.dx + bl.dy * bl.dy), ns = sp * SINC, r = ns / sp; bl.dx *= r; bl.dy *= r } }
                        if (score >= winTarget) {
                            sfxWin(); cancelAnimationFrame(animId);
                            // Brief "YOU WON!" flash then transition
                            gs = 'won_flash'; wonFlashTimer = 0;
                            function wonFlash(ts2) {
                                ctx.clearRect(0, 0, CW, CH); drawBricks(); drawPaddle(); drawParticles();
                                wonFlashTimer += 0.02;
                                const a = wonFlashTimer < 1 ? wonFlashTimer : Math.max(0, 2 - wonFlashTimer);
                                ctx.save(); ctx.font = 'bold 36px "Press Start 2P",monospace'; ctx.fillStyle = `rgba(68,255,136,${a})`; ctx.textAlign = 'center'; ctx.fillText('YOU WON!', CW / 2, CH / 2); ctx.restore();
                                if (wonFlashTimer < 2.2) { requestAnimationFrame(wonFlash) }
                                else if (!isVIP) { gs = 'win'; winScr.classList.add('active') }
                                else {
                                    gs = 'special_msg'; let smT = 0;
                                    function specialMsg() {
                                        ctx.clearRect(0, 0, CW, CH);
                                        smT += 0.012;
                                        const a = smT < 1 ? smT : (smT < 3 ? 1 : Math.max(0, 4 - smT));
                                        ctx.save(); ctx.font = 'italic 22px "Cormorant Garamond",serif'; ctx.fillStyle = `rgba(255,255,255,${a})`; ctx.textAlign = 'center';
                                        ctx.fillText("You've won... but you're special,", CW / 2, CH / 2 - 20);
                                        ctx.fillText("so there's something else waiting for you..", CW / 2, CH / 2 + 20);
                                        ctx.restore();
                                        if (smT < 4.2) requestAnimationFrame(specialMsg);
                                        else { gs = 'reveal'; startReveal() }
                                    }
                                    requestAnimationFrame(specialMsg);
                                }
                            }
                            requestAnimationFrame(wonFlash);
                            return
                        }
                        if (pu.fireball <= 0) break
                    }
                }
            }
        }

        function gameLoop(ts) { const dt = Math.min((ts - lastTime) / 1000, 0.05); lastTime = ts; ctx.clearRect(0, 0, CW, CH); update(dt); if (gs !== 'playing') return; drawBricks(); for (const b of balls) drawBall(b); drawPaddle(); drawParticles(); drawScore(); animId = requestAnimationFrame(gameLoop) }

        // ‚ïê‚ïê REVEAL (VIP only) ‚ïê‚ïê
        const RMSG = ["You cleared every obstacle.", "Some levels aren't meant to be hard.", "Some are meant to lead somewhere.", "somewhere very beautiful", "exciting", "& perhaps romantic.."];
        let ri = 0;
        function startReveal() {
            cv.style.display = 'none'; stopMusic(); $('powerup-hud').style.display = 'none';
            // Start romantic melody
            setTimeout(() => { initAudio(); playMelodyLoop(romanticMelody, 'romantic') }, 800);
            setTimeout(() => { ov.classList.add('active'); ri = 0; showRM() }, 400);
        }
        function showRM() {
            if (ri >= RMSG.length) {
                rMsg.classList.remove('visible'); cHint.classList.remove('visible');
                setTimeout(() => {
                    ov.classList.remove('active'); ov.classList.add('transparent-bg'); gs = 'proposal';
                    propTxt.textContent = `So, will you be my Valentine, ${pNameDisplay}?`;
                    propScr.classList.add('active')
                }, 800); return
            }
            rMsg.textContent = RMSG[ri]; rMsg.classList.remove('visible'); void rMsg.offsetWidth;
            setTimeout(() => { rMsg.classList.add('visible'); setTimeout(() => cHint.classList.add('visible'), 1200) }, 150);
        }
        document.addEventListener('click', e => { if (gs !== 'reveal' || e.target.closest('button')) return; cHint.classList.remove('visible'); ri++; showRM() });

        // ‚ïê‚ïê PROPOSAL (swapping buttons) ‚ïê‚ïê
        let noClicked = false;
        bNo.addEventListener('click', () => {
            // Swap Yes and No buttons
            swapped = !swapped;
            if (swapped) { propBtns.insertBefore(bNo, bYes) } else { propBtns.insertBefore(bYes, bNo) }
            if (!noClicked) { noClicked = true; const h = $('no-hint'); h.textContent = "sadly no isn't an option hehe"; h.style.opacity = '1' }
        });

        function sfxSurprise() {
            if (!actx) return;
            const freqs = [523, 659, 784, 1047, 1319, 1568];
            freqs.forEach((f, i) => {
                setTimeout(() => {
                    const o = actx.createOscillator(), g = actx.createGain();
                    o.type = 'sine'; o.frequency.value = f;
                    g.gain.setValueAtTime(0.15, actx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + 0.3);
                    o.connect(g); g.connect(actx.destination); o.start(); o.stop(actx.currentTime + 0.3);
                }, i * 80)
            });
        }

        bYes.addEventListener('click', () => {
            gs = 'celebration'; propScr.classList.remove('active');
            stopMusic(); sfxSurprise();
            document.body.classList.add('warm-bg');
            celebTxt.textContent = `I love you, ${pNameDisplay} ‚ù§Ô∏è`;
            celeb.classList.add('active'); startConfetti();
            // Romantic music for celebration
            setTimeout(() => { initAudio(); playMelodyLoop(romanticMelody, 'romantic') }, 800);
        });

        // ‚ïê‚ïê CONFETTI ‚ïê‚ïê
        let hearts = [], confRun = false;
        function startConfetti() {
            ccv.width = innerWidth; ccv.height = innerHeight; ccv.style.display = 'block'; confRun = true; hearts = [];
            for (let i = 0; i < 80; i++)hearts.push({ x: Math.random() * ccv.width, y: Math.random() * ccv.height - ccv.height, sz: 8 + Math.random() * 16, sy: 1 + Math.random() * 2, sx: (Math.random() - 0.5) * 1.5, r: Math.random() * Math.PI * 2, rs: (Math.random() - 0.5) * 0.05, o: 0.5 + Math.random() * 0.5, h: 330 + Math.random() * 40 });
            animC()
        }
        function drawH(cx, cy, sz, rot, hue, op) { cc.save(); cc.translate(cx, cy); cc.rotate(rot); cc.globalAlpha = op; cc.fillStyle = `hsl(${hue},80%,65%)`; cc.beginPath(); const s = sz / 2; cc.moveTo(0, s * 0.4); cc.bezierCurveTo(-s, -s * 0.4, -s * 0.6, -s * 1.2, 0, -s * 0.6); cc.bezierCurveTo(s * 0.6, -s * 1.2, s, -s * 0.4, 0, s * 0.4); cc.fill(); cc.restore() }
        function animC() { if (!confRun) return; cc.clearRect(0, 0, ccv.width, ccv.height); for (const h of hearts) { h.y += h.sy; h.x += h.sx; h.r += h.rs; if (h.y > ccv.height + 30) { h.y = -30; h.x = Math.random() * ccv.width } drawH(h.x, h.y, h.sz, h.r, h.h, h.o) } requestAnimationFrame(animC) }

        // ‚ïê‚ïê CONTROLS ‚ïê‚ïê
        document.addEventListener('mousemove', e => { mouseX = e.clientX });
        document.addEventListener('touchmove', e => { if (e.touches.length) mouseX = e.touches[0].clientX }, { passive: true });

        // ‚ïê‚ïê NAME ENTRY ‚ïê‚ïê
        function startGame() {
            const raw = nameIn.value.trim(), f = raw.toUpperCase().replace(/[^A-Z0-9 ]/g, '');
            if (!f) { nameErr.textContent = 'Please enter a name!'; return }
            if (f.length > 8) { nameErr.textContent = 'Too many characters! Max 8.'; return }
            pName = f;
            // Pretty display name (capitalize first letter)
            pNameDisplay = raw.charAt(0).toUpperCase() + raw.slice(1).toLowerCase();
            isVIP = VIP.has(raw.trim().toLowerCase());
            nameScr.style.display = 'none'; initAudio();
            if (!musicPlaying) playMelodyLoop(melody, 'arcade');
            gs = 'playing'; initGame(); animId = requestAnimationFrame(gameLoop);
        }
        btnSt.addEventListener('click', startGame);
        nameIn.addEventListener('keydown', e => { if (e.key === 'Enter') startGame(); nameErr.textContent = '\u00A0' });

        // ‚ïê‚ïê RETRY ‚ïê‚ïê
        function retry() { goScr.classList.remove('active'); winScr.classList.remove('active'); cv.style.display = 'block'; $('powerup-hud').style.display = 'flex'; gs = 'playing'; initGame(); animId = requestAnimationFrame(gameLoop) }
        bRetry.addEventListener('click', retry);
        bWinRetry.addEventListener('click', retry);
        window.addEventListener('resize', () => { if (confRun) { ccv.width = innerWidth; ccv.height = innerHeight } });
    </script>
</body>

</html>